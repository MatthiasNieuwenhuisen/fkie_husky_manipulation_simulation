<launch>
      <arg name="robot_namespace" default="husky"/>
      <arg name="global_frame" default="/world"/>
      <arg name="capability_group" default="base"/>
      <arg name="use_gripper" default="false" doc="Should a franka hand be mounted on the flange?" />
      <arg name="controller" default=" "/>
      <arg name="paused" default="false" doc="Should the simulation directly be stopped at 0s?" />
      <arg name="arm_id" default="panda" doc="Name of the panda robot to spawn" />
      <arg name="x" default="6" doc="How far forward to place the base of the husky robot in [m]?" />
      <arg name="y" default="-15" doc="How far leftwards to place the base of the husky robot in [m]?" />
      <arg name="z" default="0.15" doc="How far upwards to place the base of the husky robot in [m]?" />
      <arg name="yaw" default="2.626509" doc="How much to rotate the base of the husky robot around its Z-axis in [rad]?" />
      <arg name="initial_joint_positions" doc="Initial joint configuration of the panda. Specify as a list of name/value pairs in form of '-J [name-of-joint] [value-in-rad]'. Default is a 90 degree bend in the elbow" default="-J $(arg arm_id)_joint1 0
                -J $(arg arm_id)_joint2 0
                -J $(arg arm_id)_joint3 0
                -J $(arg arm_id)_joint4 -1.57079632679
                -J $(arg arm_id)_joint5 0
                -J $(arg arm_id)_joint6 1.57079632679
                -J $(arg arm_id)_joint7 0.785398163397
                -J $(arg arm_id)_finger_joint1 0.001
                -J $(arg arm_id)_finger_joint2 0.001" />

      <group ns="$(arg robot_namespace)">
            <!-- Load robot description  -->
            <param name="robot_description" command="xacro $(find fkie_husky_manipulation_simulation)/urdf/husky_panda.urdf.xacro robot_namespace:=$(arg robot_namespace) hand:=$(arg use_gripper) arm_id:=$(arg arm_id)">
            </param>
            
             <!-- Convert joint states to TF  -->
            <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" clear_params="true">
                  <param name="capability_group" value="$(arg capability_group)"/>
                  <param name="nm/kill_on_stop" value="300"/>
            </node>
            
             <node name="joint_state_publisher" type="joint_state_publisher" pkg="joint_state_publisher">
             <rosparam param="source_list">[effort_joint_trajectory_controller/joint_states, franka_gripper/joint_states] </rosparam>
              <param name="rate" value="30"/>
            </node>

            <!-- Load the controller configs  -->
            <rosparam file="$(find franka_gazebo)/config/franka_hw_sim.yaml" subst_value="true" />
            <rosparam file="$(find franka_gazebo)/config/sim_controllers.yaml" subst_value="true" />
            <rosparam file="$(find fkie_husky_manipulation_simulation)/config/test.yaml" command="load"/>
            
            <arg name="unpause" value="$(eval '' if arg('paused') else '-unpause')" />

            <!--  Spawn the robot   -->
            <node name="$(arg robot_namespace)_$(arg arm_id)_full_model_spawner" pkg="gazebo_ros" type="spawn_model" args="-x $(arg x) -y $(arg y) -z $(arg z) -Y $(arg yaw)
              -param /$(arg robot_namespace)/robot_description -urdf -model $(arg robot_namespace) $(arg unpause)
              $(arg initial_joint_positions) 
              "/>
              
             <node name="$(arg robot_namespace)_$(arg arm_id)_controller_spawner" pkg="controller_manager" type="spawner" output="screen" args="husky_joint_publisher husky_velocity_controller effort_joint_trajectory_controller">
                  <param name="capability_group" value="$(arg capability_group)"/>
                  <param name="nm/kill_on_stop" value="300"/>
            </node>

            <!-- Add static transform between odom and world  -->
            <node name="$(arg robot_namespace)_static_tf_world_odom" pkg="tf2_ros" type="static_transform_publisher" args="0 0 0 0 0 0 $(arg global_frame) odom">
                  <param name="capability_group" value="$(arg capability_group)"/>
                  <param name="nm/kill_on_stop" value="300"/>
            </node>
            
            <!--TODO:check if okay, Add static transform between odom and base_link  -->
            <node name="$(arg robot_namespace)_static_tf_odom_baselink" pkg="tf2_ros" type="static_transform_publisher" args="0 0 0 0 0 0 odom base_link">
                  <param name="capability_group" value="$(arg capability_group)"/>
                  <param name="nm/kill_on_stop" value="300"/>
            </node>

  


      </group>
     
</launch>